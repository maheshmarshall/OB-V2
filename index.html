<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Management UI</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for the page */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple animation for button hover */
        .btn-hover-effect {
            transition: all 0.2s ease-in-out;
        }
        .btn-hover-effect:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .active-btn {
            background-color: #3B82F6; /* blue-500 */
            color: white;
        }
        .action-btn-active {
            background-color: #2563EB; /* blue-600 */
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status-btn-active {
            background-color: #10B981; /* green-500 */
            color: white;
        }
        /* Custom scrollbar for category list */
        .category-list::-webkit-scrollbar {
            width: 8px;
        }
        .category-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .category-list::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .category-list::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* Styles for modals */
        .modal-hidden {
            display: none;
        }
        .autosize-person-textarea {
            resize: none;
            overflow-y: hidden;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="modal-hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
        <div class="relative mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Confirm Action</h3>
                <div class="mt-2 px-7 py-3">
                    <p id="confirm-modal-message" class="text-sm text-gray-500"></p>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="modal-confirm-btn" class="px-4 py-2 bg-green-500 text-white text-base font-medium rounded-md w-auto shadow-sm hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-300">
                        Confirm
                    </button>
                    <button id="modal-cancel-btn" class="px-4 py-2 bg-red-500 text-white text-base font-medium rounded-md w-auto ml-2 shadow-sm hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-300">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success/Notification Modal -->
    <div id="success-modal" class="modal-hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
        <div class="relative mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 id="success-modal-title" class="text-lg leading-6 font-medium text-gray-900">Success</h3>
                <div class="mt-2 px-7 py-3">
                    <p id="success-modal-message" class="text-sm text-gray-500"></p>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="success-modal-ok-btn" class="px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md w-auto shadow-sm hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-300">
                        OK
                    </button>
                </div>
            </div>
        </div>
    </div>


    <div class="container mx-auto p-4 md:p-8">
        <div class="flex flex-col md:flex-row bg-white rounded-xl shadow-lg min-h-[80vh]">
            
            <!-- Sidebar Navigation -->
            <aside class="w-full md:w-64 p-6 border-b md:border-b-0 md:border-r border-gray-200">
                <nav id="sidebar-nav" class="space-y-4">
                    <!-- Navigation Button: OB Entry -->
                    <button id="ob-entry-btn" data-view="ob-entry-view" class="w-full flex items-center justify-between p-3 rounded-lg bg-blue-500 text-white font-semibold shadow-md btn-hover-effect">
                        <span>OB Entry</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                    </button>
                    <!-- Navigation Button: Category Edit -->
                    <button data-view="category-edit-view" class="w-full text-left p-3 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">Category Edit</button>
                    
                    <!-- Other Navigation Buttons -->
                    <button data-view="recoveries-view" class="w-full text-left p-3 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">Recoveries</button>
                    <button data-view="complaints-view" class="w-full text-left p-3 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">Complaints</button>
                    <button data-view="positive-arrests-view" class="w-full text-left p-3 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">Positive Arrests</button>
                    <button data-view="add-remove-users-view" class="w-full text-left p-3 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">Add/Remove Users</button>
                </nav>
            </aside>

            <!-- Main Content Area -->
            <main id="main-content" class="flex-1 p-6 md:p-10 overflow-auto">
                <!-- OB Entry View (Now visible by default) -->
                <div id="ob-entry-view" class="view-panel">
                    <div id="ob-actions" class="flex justify-center space-x-4 mb-6">
                        <button data-action="add" class="ob-action-btn px-6 py-2 rounded-lg bg-blue-500 text-white font-semibold shadow-md btn-hover-effect action-btn-active">Add Record</button>
                        <button data-action="remove" class="ob-action-btn px-6 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">Remove Record</button>
                        <button data-action="update" class="ob-action-btn px-6 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">Update Record</button>
                        <button data-action="view" class="ob-action-btn px-6 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">View Record</button>
                    </div>

                    <div class="border rounded-lg p-6 bg-gray-50">
                        <div class="flex justify-between items-center border-b pb-4 mb-6">
                             <h2 class="text-xl font-bold text-gray-800">Occurrence Book (INSERT)</h2>
                             <span class="text-sm font-medium text-gray-600">UID:</span>
                        </div>
                       
                        <form id="ob-form" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">OB Number:</label>
                                    <span id="ob-number-display" class="font-bold text-gray-800"></span>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Created:</label>
                                    <span id="created-date" class="text-gray-800"></span>
                                </div>
                            </div>
                            <div class="grid grid-cols-1">
                                <div class="flex items-center">
                                    <label class="w-48 text-gray-600 font-medium">Time of Incident:</label>
                                    <span class="mr-2">From</span>
                                    <input type="datetime-local" class="p-2 border rounded-md w-full">
                                    <span class="mx-2">To</span>
                                    <input type="datetime-local" class="p-2 border rounded-md w-full">
                                </div>
                            </div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Created By:</label>
                                    <span class="text-gray-800">Mahesh Palad</span>
                                </div>
                            </div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">OB Type<span class="text-red-500">*</span>:</label>
                                    <select id="ob-type-select" class="p-2 border rounded-md w-2/3"></select>
                                </div>
                            </div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">OB Category:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                            </div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Police Station:</label>
                                    <select id="police-station-select" class="p-2 border rounded-md w-2/3"></select>
                                </div>
                            </div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">CAS Number:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                            </div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">SAP 13 Number:</label>
                                    <div class="flex items-center w-2/3 space-x-2">
                                        <input type="text" id="sap-number-input" class="p-2 border rounded-md shrink-0 numeric-only" placeholder="Number">
                                        <span class="text-gray-500">/</span>
                                        <select id="sap-month-select" class="p-2 border rounded-md"></select>
                                        <span class="text-gray-500">/</span>
                                        <select id="sap-year-select" class="p-2 border rounded-md"></select>
                                    </div>
                                </div>
                            </div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Requires Followup:</label>
                                    <input type="checkbox" class="h-5 w-5">
                                </div>
                            </div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Follow up User:</label>
                                    <select id="follow-up-user-select" class="p-2 border rounded-md w-2/3"></select>
                                </div>
                            </div>
                            
                            <!-- Location Information Section -->
                            <div class="border-t pt-6 mt-6">
                                <h3 class="text-lg font-semibold text-gray-700 mb-4">Location Information</h3>
                                <div class="space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div class="flex items-center">
                                            <label class="w-1/3 text-gray-600 font-medium">Area:</label>
                                            <div class="flex w-2/3">
                                                <select id="area-select" class="p-2 border rounded-md w-full"></select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div class="flex items-center">
                                            <label class="w-1/3 text-gray-600 font-medium">Client:</label>
                                            <div class="flex items-center w-2/3">
                                                <span class="text-gray-800 mr-4">Recorded as Non-Client</span>
                                                <button type="button" class="px-4 py-2 bg-blue-500 text-white rounded-md btn-hover-effect">Lookup</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                        <div class="flex items-center">
                                            <label class="w-1/3 text-gray-600 font-medium">Client Account:</label>
                                            <input type="text" class="p-2 border rounded-md w-2/3">
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                        <div class="flex items-center">
                                            <label class="w-1/3 text-gray-600 font-medium">Contact No:</label>
                                            <input type="text" id="contact-no-input" class="p-2 border rounded-md w-2/3 numeric-only">
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 gap-6 bg-blue-50 p-4 rounded-md">
                                         <div class="flex">
                                            <label class="w-1/6 text-gray-600 font-medium">Address:</label>
                                            <div class="w-5/6 space-y-2">
                                                <input type="text" class="p-2 border rounded-md w-full">
                                                <input type="text" class="p-2 border rounded-md w-full">
                                                <input type="text" class="p-2 border rounded-md w-full">
                                            </div>
                                        </div>
                                    </div>
                                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                        <div class="flex items-center">
                                            <label class="w-1/3 text-gray-600 font-medium">Latitude:</label>
                                            <input type="text" class="p-2 border rounded-md w-2/3">
                                        </div>
                                         <div class="flex items-center">
                                            <label class="w-1/3 text-gray-600 font-medium">Longitude:</label>
                                            <input type="text" class="p-2 border rounded-md w-2/3">
                                        </div>
                                    </div>
                                     <div class="grid grid-cols-1 gap-6">
                                         <div class="flex">
                                            <label class="w-1/6 text-gray-600 font-medium">Comments:</label>
                                            <textarea class="p-2 border rounded-md w-5/6 h-24"></textarea>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div class="flex items-center">
                                            <label class="w-1/3 text-gray-600 font-medium">Status:</label>
                                            <div id="status-buttons" class="flex space-x-2">
                                                <button type="button" class="status-btn px-4 py-2 rounded-md bg-gray-200 text-gray-700 status-btn-active">Open</button>
                                                <button type="button" class="status-btn px-4 py-2 rounded-md bg-gray-200 text-gray-700">Closed</button>
                                                <button type="button" class="status-btn px-4 py-2 rounded-md bg-gray-200 text-gray-700">Pending</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Suspicious Vehicles Section -->
                            <div class="border-t pt-6 mt-6">
                                <h3 class="text-lg font-semibold text-gray-700 mb-4">Suspicious Vehicles</h3>
                                <div class="space-y-4">
                                    <div class="flex justify-end mb-2">
                                        <button type="button" id="add-vehicle-btn" class="px-4 py-2 bg-blue-500 text-white rounded-md btn-hover-effect">Add Vehicle</button>
                                    </div>
                                    <div class="overflow-x-auto">
                                        <table class="min-w-full bg-white border">
                                            <thead class="bg-gray-200">
                                                <tr>
                                                    <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">Registration</th>
                                                    <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">Make</th>
                                                    <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">Model</th>
                                                    <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">Colour</th>
                                                    <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="suspicious-vehicles-tbody">
                                                <!-- Dynamic rows will be inserted here -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pt-4">
                                        <div class="flex items-center">
                                            <input id="bolo-checkbox" type="checkbox" class="h-5 w-5 mr-2">
                                            <label for="bolo-checkbox" class="text-gray-600 font-medium">BOLO (Be on the Lookout)</label>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 gap-6">
                                         <div class="flex">
                                            <label class="w-1/6 text-gray-600 font-medium">Comments:</label>
                                            <textarea class="p-2 border rounded-md w-5/6 h-24"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Persons of Interest Section -->
                            <div class="border-t pt-6 mt-6">
                                <h3 class="text-lg font-semibold text-gray-700 mb-4">Persons of Interest</h3>
                                <div class="space-y-4">
                                    <div class="flex justify-end mb-2">
                                        <button type="button" id="add-person-btn" class="px-4 py-2 bg-blue-500 text-white rounded-md btn-hover-effect">Add Person</button>
                                    </div>
                                    <div class="overflow-x-auto">
                                        <table class="min-w-full bg-white border">
                                            <thead class="bg-gray-200">
                                                <tr>
                                                    <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">Firstname</th>
                                                    <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">Lastname</th>
                                                    <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">Age</th>
                                                    <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">Ethnicity</th>
                                                    <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">Hair</th>
                                                    <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">Eye</th>
                                                    <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">Gender</th>
                                                    <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">Id</th>
                                                    <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">Description</th>
                                                    <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="persons-of-interest-tbody">
                                                <!-- Dynamic rows will be inserted here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>


                            <!-- Save Button -->
                            <div class="flex justify-end pt-4">
                                <button type="button" id="save-record-btn" class="px-8 py-3 bg-green-500 text-white font-bold rounded-lg shadow-lg btn-hover-effect">Save Record</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Category Edit View -->
                <div id="category-edit-view" class="view-panel hidden">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Category Editor</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <label for="category-selector" class="block text-sm font-medium text-gray-700 mb-2">Select a category to edit:</label>
                            <select id="category-selector" class="w-full p-2 border rounded-md">
                                <option value="obType">OB Type</option>
                                <option value="policeStation">Police Station</option>
                                <option value="followUpUser">Follow up User</option>
                                <option value="area">Area</option>
                                <option value="vehicleMake">Vehicle Make</option>
                                <option value="ethnicity">Ethnicity</option>
                                <option value="division">Division</option>
                                <option value="recoveryType">Recovery Type</option>
                                <option value="incidentType">Incident Type</option>
                            </select>
                        </div>
                        <div id="editor-panel">
                            <h3 id="editing-category-name" class="text-xl font-semibold mb-4"></h3>
                            <div class="bg-gray-50 border rounded-lg p-4">
                                <div class="mb-4">
                                    <label for="new-item-input" class="block text-sm font-medium text-gray-700">Add new item:</label>
                                    <div class="mt-1 flex rounded-md shadow-sm">
                                        <input type="text" id="new-item-input" class="flex-1 block w-full rounded-none rounded-l-md p-2 border-gray-300" placeholder="New category item">
                                        <button id="add-item-btn" class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 hover:bg-gray-100">Add</button>
                                    </div>
                                </div>
                                <div id="category-item-list" class="category-list max-h-80 overflow-y-auto space-y-2">
                                    <!-- Items will be dynamically inserted here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recoveries View -->
                <div id="recoveries-view" class="view-panel hidden">
                     <div id="recoveries-actions" class="flex justify-center space-x-4 mb-6">
                        <button data-action="add" class="ob-action-btn px-6 py-2 rounded-lg bg-blue-500 text-white font-semibold shadow-md btn-hover-effect action-btn-active">Add Record</button>
                        <button data-action="remove" class="ob-action-btn px-6 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">Remove Record</button>
                        <button data-action="update" class="ob-action-btn px-6 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">Update Record</button>
                        <button data-action="view" class="ob-action-btn px-6 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">View Record</button>
                    </div>
                    <div class="border rounded-lg p-6 bg-gray-50">
                        <h2 class="text-xl font-bold text-gray-800 mb-6 border-b pb-4">Recoveries</h2>
                        <form class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Date and Time:</label>
                                    <input type="datetime-local" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Name:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Division:</label>
                                    <select id="recovery-division-select" class="p-2 border rounded-md w-2/3"></select>
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Recovery Type:</label>
                                    <select id="recovery-type-select" class="p-2 border rounded-md w-2/3"></select>
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Incident Type:</label>
                                    <select id="recovery-incident-type-select" class="p-2 border rounded-md w-2/3"></select>
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Duration of Incident:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Registration:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Vin Number:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Items Recovered:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Vehicle Brand:</label>
                                    <select id="recovery-vehicle-brand-select" class="p-2 border rounded-md w-2/3"></select>
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Make of vehicle:</label>
                                     <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Police Station (From):</label>
                                    <select id="recovery-ps-from-select" class="p-2 border rounded-md w-2/3"></select>
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Case number:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Police Station (Recovered):</label>
                                    <select id="recovery-ps-recovered-select" class="p-2 border rounded-md w-2/3"></select>
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">SAPS 13 Number:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Estimated Value of vehicle:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                 <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Estimated Value of Items:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                 <div class="flex items-center col-span-1 md:col-span-2">
                                    <label class="w-1/6 text-gray-600 font-medium">Address Of Incident:</label>
                                    <textarea class="p-2 border rounded-md w-5/6 h-20"></textarea>
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Coordinates (Recovery):</label>
                                    <div class="flex w-2/3 gap-2">
                                        <input type="text" placeholder="Latitude" class="p-2 border rounded-md w-1/2">
                                        <input type="text" placeholder="Longitude" class="p-2 border rounded-md w-1/2">
                                    </div>
                                </div>
                                 <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Marshall OB number:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Recovered by:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Photo of Vehicle Stolen:</label>
                                    <input type="file" class="p-1 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Photo of Items Stolen:</label>
                                    <input type="file" class="p-1 border rounded-md w-2/3">
                                </div>
                            </div>
                             <div class="flex justify-end pt-4">
                                <button type="button" class="px-8 py-3 bg-green-500 text-white font-bold rounded-lg shadow-lg btn-hover-effect">Save Recovery</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div id="complaints-view" class="view-panel hidden flex items-center justify-center h-full border-2 border-dashed border-gray-300 rounded-xl">
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-500">Complaints</h1>
                </div>
                <div id="positive-arrests-view" class="view-panel hidden flex items-center justify-center h-full border-2 border-dashed border-gray-300 rounded-xl">
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-500">Positive Arrests</h1>
                </div>
                <div id="add-remove-users-view" class="view-panel hidden flex items-center justify-center h-full border-2 border-dashed border-gray-300 rounded-xl">
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-500">Add/Remove Users</h1>
                </div>
            </main>
        </div>
    </div>

    <script>
        // Immediately hide modals to prevent flash on load
        document.getElementById('confirmation-modal').style.display = 'none';
        document.getElementById('success-modal').style.display = 'none';

        document.addEventListener('DOMContentLoaded', () => {
            // --- STATE MANAGEMENT ---
            let obCounter = 1;
            let currentRecordAction = 'add'; // Default action
            let dropdownOptions; // Will be loaded from localStorage or defaults
            let personRowCounter = 0;

            // Default data structure in case localStorage is empty
            const defaultDropdownOptions = {
                obType: [
                    "ABDUCTION", "ACCIDENT", "ACCIDENT/INJURY", "ACCIDENTAL DISCHARGE OF FIREARM", "ALARM ACTIVATIONS", "ARMED ROBBERY", 
                    "ARMED ROBBERY WITH SHOOTING INCIDENT", "ARREST AND RECOVERY", "ARREST OF SUSPECT/S", "ARSON - FIRE", "ASSAULT", "ATM CRIMES", 
                    "ATTACK ON PERSON/PERSONS", "ATTEMPED THEFT OUT OF MOTOR VEHICLE", "ATTEMPTED ARMED ROBBERY", "ATTEMPTED BUSINESS BREAKING", 
                    "ATTEMPTED BUSINESS ROBBERY", "ATTEMPTED ENTRY IN COMPLEX VIA FENCE/GATE", "ATTEMPTED HI JACKING", "ATTEMPTED HOUSE BREAKING WITH THEFT", 
                    "ATTEMPTED HOUSE BREAKING WITHOUT THEFT", "ATTEMPTED HOUSE ROBBERY", "ATTEMPTED KIDNAPPING", "ATTEMPTED MUGGING", "ATTEMPTED MURDER", 
                    "ATTEMPTED RAPE", "ATTEMPTED REMOTE JAMMING", "ATTEMPTED SUICIDE", "ATTEMPTED THEFT", "ATTEMPTED THEFT OF MOTOR VEHICLE", "AUDIT FINDING", 
                    "AUDIT FINDINGS", "AURA RESPONSES", "BICYCLE REPAIRS", "BOOKING OFF", "BUSINESS BREAKING", "BUSINESS ROBBERY", "CCTV MALFUNCTION ON SITE", 
                    "CLIENT COMPLAINT", "Common Robbery", "Common Theft", "Culpable Homicide", "DAMAGE ON SITE", "DISCIPLINARY", "DISTURBANCE ON SITE", 
                    "DOMESTIC ISSUE", "DOOR LEFT UNLOCKED/OPEN", "DRINKING IN PUBLIC", "DRIVING UNDER THE INFLUENCE", "DROWNING", "DRUNK DRIVING"
                ],
                policeStation: [
                    "No Police Station Selected", "Alexandra Road", "Amangwe/Loskop", "Amanzimtoti", "Babanango", "Bayview", "Bellair", "Berea", "Bergville", "Besters", "Bhekithemba", 
                    "Bishopstowe", "Boston", "Brighton Beach", "Bulwer", "Camperdown", "Cato Manor", "Ceza", "Charlestown", "Chatsworth", "Colenso", "Cramond", 
                    "Creighton", "Dalton", "Dannhauser", "Donnybrook", "Dududu", "Dundee", "Durban Central", "Durban Harbour", "Durban North", "Ekombe", "Ekuvukeni", 
                    "Elandslaagte", "Emanguzi", "Ematimatolo", "Ematsheni", "Emondlo", "Empangeni", "Eshowe", "Esikhawini", "Estcourt", "Evatt", "Ezakheni", 
                    "Ezibayeni", "Ezinqoleni", "Folweni", "Franklin", "Gamalakhe", "Gingindlovu", "Glencoe", "Glendale", "Gluckstadt", "Gowan Lea", "Greenwood Park", 
                    "Greytown", "Groenvlei", "Hammersdale", "Harburg", "Harding", "Hattingspruit", "Helpmekaar", "Hibberdene", "Highflats", "Hillcrest", "Hilton-Kzn", 
                    "Himeville", "Hlabisa", "Hlobane", "Hluhluwe", "Howick", "Ibisi", "Impendle", "Inanda", "Inchanga", "Ingogo", "Ingwavuma", "Intsikeni", "Isipingo", 
                    "Ixopo", "Jozini", "King Shaka International Airport", "Kingsley", "Kokstad", "Kranskop", "Kwa Dabeka", "KwaMashu E", "Kwadukuza", "Kwamakutha", 
                    "Kwambonambi", "Kwamsane", "Kwandengezi", "Ladysmith", "Lamontville", "Louwsburg", "Madadeni", "Magudu", "Mahlabathini", "Malvern", "Mandeni", 
                    "Maphumulo", "Margate", "Mariannhill", "Mayville", "Mbazwana", "Mbongolwane", "Mehlomnyama", "Melmoth", "Mid Illovo", "Mkuze", "Mondlo", "Montclair", 
                    "Mooi Rivier", "Mountain Rise", "Mpophomeni", "Mpumalanga-Kzn", "Mpungamhlophe", "Msinga", "Msinsini", "Mtubatuba", "Mtunzini", "Muden", "Ndumo", 
                    "Ndwedwe", "New Hanover", "Newcastle", "Ngome", "Ngwavuma", "Nkandla", "Nongoma", "Nqutu", "Nottingham Road", "Okhahlamba", "Oribi", "Paulpietersburg", 
                    "Plessislaer", "Point", "Pomeroy", "Pongola", "Port Edward", "Port Shepstone", "Prestbury", "Richards Bay", "Richmond-Kzn", "Rietvlei", "Sawoti", 
                    "Scottburgh", "Stanger", "Sundumbili", "Swartberg", "Sydenham", "Taylors Halt", "Thornville", "Tongaat", "Town Hill", "Tugela Ferry", "Ubombo", 
                    "Umbilo", "Umhlali", "Umkomaas", "Umlazi", "Umsinga", "Umzinto", "Umzinto North", "Underberg", "Utrecht", "Van Reenen", "Verulam", "Vryheid", 
                    "Wartburg", "Weenen", "Wentworth", "Westville"
                ],
                followUpUser: ["No User Selected", "Admin", "Operator 1", "Investigator"],
                area: [
                    "No Area Selected", "AMAOTI", "ATHLONE", "AVOCA", "AVOCA HILLS", "BALLITO", "BELLAIR", "BEREA", "BLUFF", "BRIARDENE", "CHESTERVILLE", "CLAREMONT", "CORNUBIA", 
                    "DURBAN CENTRAL", "DURBAN NORTH", "EFFINGHAM", "GLEN ANIL", "GLEN HILLS", "GLENASHLEY", "GREENWOOD PARK", "HERWOOD PARK", "INANDA", "IZINGA RIDGE", 
                    "KENVILLE", "KWA MASHU", "LA LUCIA", "LA LUCIA RIDGE", "LOWER LA LUCIA", "LOWER UMHLANGA", "M4 SOUTHERN FREEWAY", "MAPHUMULO", "MORNINGSIDE", 
                    "MOUNT EDGECOMBE", "MOUNT MORIAH", "N2 FREEWAY", "N2/M7 FREEWAY", "NDWEDWE", "NEWLANDS EAST", "NEWLANDS WEST", "NKANDLA", "NTUZUMU", "PARK HILL", 
                    "PHOENIX", "PINETOWN", "PRESTONDALE", "RED HILL", "RICHMOND", "RIVERHORSE VALLEY", "ROSEHILL", "SALT ROCK", "SAVANAH PARK", "SEACOWLAKE", 
                    "SHEFFIELD BEACH", "SHERWOOD", "SOMERSET PARK", "SOUTH LYING AREAS", "SPRINGFIELD", "SPRINGFIELD PARK", "STAMFORDHILL", "SUNNINGDALE", "UMDLOTI", 
                    "UMGENI PARK", "UMHLALI", "UMHLANGA", "UMHLANGA MANORS", "UMHLANGA RIDGE", "VERULAM", "VIRGINIA", "WESTBROOK", "WESTMEAD - SECTOR ONE", 
                    "WESTMEAD SECTOR TWO", "WESTVILLE", "WYEBANK"
                ],
                vehicleMake: [
                    "No vehicle selected", "Volkswagen", "Toyota", "Hyundai", "Isuzu", "Nissan", "Alfa Romeo", "Audi", "BMW", "Chery", "Chevrolet", "Chrysler", "Citroen", "Datsun", "Dodge", "Fiat", "Ford", "Haval", "Honda", "Infiniti", "Jaguar", "Jeep", "Kia", "LandRover", "Lexus", "Mahindra", "Mazda", "Mercedes-Benz", "Mini", "Mitsubishi", "Opel", "Peugeot", "Renault", "Saab", "Scion", "Seat", "Skoda", "Subaru", "Suzuki", "Volvo"
                ],
                ethnicity: [
                    "No Ethnicity Selected", "Asian", "Black", "Coloured", "Indian", "White", "Other"
                ],
                division: [
                    "No Division Selected", "SOT", "Reaction", "WestMead (Sector 1)", "WestMead (Sector 2)"
                ],
                recoveryType: [
                    "No Recovery Type Selected", "Vehicle", "Items"
                ],
                incidentType: [
                    "No Incident Type Selected", "HIJACKED", "STOLEN", "MISSING PERSON", "HOUSE BREAKING", "SNIPR", "FRAUD", "THEFT"
                ]
            };

            // --- ELEMENT REFERENCES ---
            const sidebarNav = document.getElementById('sidebar-nav');
            const viewPanels = document.querySelectorAll('.view-panel');
            const obNumberDisplay = document.getElementById('ob-number-display');
            const obActionButtons = document.querySelectorAll('.ob-action-btn');
            const saveRecordBtn = document.getElementById('save-record-btn');
            const obTypeSelect = document.getElementById('ob-type-select');
            const policeStationSelect = document.getElementById('police-station-select');
            const followUpUserSelect = document.getElementById('follow-up-user-select');
            const areaSelect = document.getElementById('area-select');
            const categorySelector = document.getElementById('category-selector');
            const editingCategoryName = document.getElementById('editing-category-name');
            const categoryItemList = document.getElementById('category-item-list');
            const newItemInput = document.getElementById('new-item-input');
            const addItemBtn = document.getElementById('add-item-btn');
            const createdDateEl = document.getElementById('created-date');
            const sapMonthSelect = document.getElementById('sap-month-select');
            const sapYearSelect = document.getElementById('sap-year-select');
            const sapNumberInput = document.getElementById('sap-number-input');
            const statusButtonsContainer = document.getElementById('status-buttons');
            const addVehicleBtn = document.getElementById('add-vehicle-btn');
            const suspiciousVehiclesTbody = document.getElementById('suspicious-vehicles-tbody');
            const addPersonBtn = document.getElementById('add-person-btn');
            const personsOfInterestTbody = document.getElementById('persons-of-interest-tbody');
            const obForm = document.getElementById('ob-form');
            const recoveryVehicleBrandSelect = document.getElementById('recovery-vehicle-brand-select');
            const recoveryPsFromSelect = document.getElementById('recovery-ps-from-select');
            const recoveryPsRecoveredSelect = document.getElementById('recovery-ps-recovered-select');
            const recoveryDivisionSelect = document.getElementById('recovery-division-select');
            const recoveryTypeSelect = document.getElementById('recovery-type-select');
            const recoveryIncidentTypeSelect = document.getElementById('recovery-incident-type-select');

            // Modal References
            const confirmModal = document.getElementById('confirmation-modal');
            const confirmModalMessage = document.getElementById('confirm-modal-message');
            const modalConfirmBtn = document.getElementById('modal-confirm-btn');
            const modalCancelBtn = document.getElementById('modal-cancel-btn');
            
            const successModal = document.getElementById('success-modal');
            const successModalTitle = document.getElementById('success-modal-title');
            const successModalMessage = document.getElementById('success-modal-message');
            const successModalOkBtn = document.getElementById('success-modal-ok-btn');

            // --- FUNCTIONS ---

            const showConfirmationModal = (message, onConfirmCallback) => {
                confirmModalMessage.textContent = message;
                confirmModal.style.display = 'flex'; // Use flex to center it
                const newConfirmBtn = modalConfirmBtn.cloneNode(true);
                modalConfirmBtn.parentNode.replaceChild(newConfirmBtn, modalConfirmBtn);
                newConfirmBtn.addEventListener('click', () => {
                    confirmModal.style.display = 'none';
                    onConfirmCallback();
                });
            };
            
            modalCancelBtn.addEventListener('click', () => confirmModal.style.display = 'none');

            const showSuccessModal = (title, message) => {
                successModalTitle.textContent = title;
                successModalMessage.textContent = message;
                successModal.style.display = 'flex'; // Use flex to center it
            };

            successModalOkBtn.addEventListener('click', () => successModal.style.display = 'none');

            const saveDropdownOptions = () => localStorage.setItem('dropdownData', JSON.stringify(dropdownOptions));
            
            const loadDropdownOptions = () => {
                const savedData = localStorage.getItem('dropdownData');
                const savedOptions = savedData ? JSON.parse(savedData) : {};
                // Robustly merge defaults with saved data.
                dropdownOptions = { ...defaultDropdownOptions };
                for (const key in savedOptions) {
                    if (Object.hasOwnProperty.call(savedOptions, key) && Array.isArray(savedOptions[key])) {
                        dropdownOptions[key] = savedOptions[key];
                    }
                }
            };
            
            const showView = (viewId) => {
                viewPanels.forEach(panel => {
                    panel.id === viewId ? panel.classList.remove('hidden') : panel.classList.add('hidden');
                });
                if (viewId === 'ob-entry-view') updateObNumberDisplay();
            };

            const populateDropdown = (selectElement, options) => {
                if (!selectElement) return;
                selectElement.innerHTML = '';
                options.forEach(optionText => {
                    const option = document.createElement('option');
                    option.value = optionText;
                    option.textContent = optionText;
                    selectElement.appendChild(option);
                });
            };
            
            const populateSapDropdowns = () => {
                // Populate months
                const months = ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12'];
                months.forEach(month => {
                    const option = document.createElement('option');
                    option.value = month;
                    option.textContent = month;
                    sapMonthSelect.appendChild(option);
                });

                // Populate years
                const currentYear = new Date().getFullYear();
                for (let i = 0; i < 10; i++) {
                    const year = currentYear + i;
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    sapYearSelect.appendChild(option);
                }
            };
            
            const autosizeInput = (inputElement) => {
                if (!inputElement) return;
                const tempSpan = document.createElement('span');
                tempSpan.style.visibility = 'hidden';
                tempSpan.style.position = 'absolute';
                tempSpan.style.whiteSpace = 'nowrap';
                tempSpan.style.font = window.getComputedStyle(inputElement).font;
                
                tempSpan.textContent = inputElement.value || inputElement.placeholder;
                
                document.body.appendChild(tempSpan);
                const width = tempSpan.offsetWidth;
                document.body.removeChild(tempSpan);

                // Set a minimum width and add padding
                inputElement.style.width = `${Math.max(60, width + 20)}px`;
            };

            const autosizeSelect = (selectElement) => {
                if (!selectElement) return;
                // Create a hidden span to measure text width
                const tempSpan = document.createElement('span');
                tempSpan.style.visibility = 'hidden';
                tempSpan.style.position = 'absolute';
                tempSpan.style.whiteSpace = 'nowrap';
                tempSpan.style.font = window.getComputedStyle(selectElement).font;
                
                const selectedOption = selectElement.options[selectElement.selectedIndex];
                tempSpan.textContent = selectedOption ? selectedOption.textContent : '';
                
                document.body.appendChild(tempSpan);
                const width = tempSpan.offsetWidth;
                document.body.removeChild(tempSpan);

                // Add some padding for the dropdown arrow and to prevent text clipping
                selectElement.style.width = `${width + 30}px`;
            };

            const autosizeTextarea = (textarea) => {
                if (!textarea) return;
                textarea.style.height = 'auto'; // Reset height
                textarea.style.height = textarea.scrollHeight + 'px'; // Set to scroll height
            }

            const renderCategoryEditor = (categoryKey) => {
                const categoryData = dropdownOptions[categoryKey] || [];
                editingCategoryName.textContent = `Editing: ${categorySelector.options[categorySelector.selectedIndex].text}`;
                categoryItemList.innerHTML = '';
                categoryData.forEach((item, index) => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'flex justify-between items-center p-2 bg-white rounded-md shadow-sm';
                    itemDiv.innerHTML = `
                        <span class="flex-grow">${item}</span>
                        <button data-item="${item}" data-index="${index}" class="text-red-500 hover:text-red-700 font-bold delete-item-btn p-1">X</button>
                    `;
                    categoryItemList.appendChild(itemDiv);
                });
            };

            const updateObNumberDisplay = () => {
                obNumberDisplay.textContent = obCounter;
                createdDateEl.textContent = new Date().toLocaleString();
            };

            const handleAddItem = () => {
                const selectedCategory = categorySelector.value;
                const newItem = newItemInput.value.trim();
                if (newItem && !dropdownOptions[selectedCategory].includes(newItem)) {
                    showConfirmationModal(`Are you sure you want to add "${newItem}"?`, () => {
                        dropdownOptions[selectedCategory].push(newItem);
                        saveDropdownOptions();
                        renderCategoryEditor(selectedCategory);
                        updateAllDropdowns();
                        newItemInput.value = '';
                        showSuccessModal('Success', `Successfully added "${newItem}".`);
                    });
                } else if (newItem) {
                    showSuccessModal('Error', `Item "${newItem}" already exists in this category.`);
                }
            };

            const handleDeleteItem = (event) => {
                const deleteButton = event.target.closest('.delete-item-btn');
                if (deleteButton) {
                    const selectedCategory = categorySelector.value;
                    const itemIndex = parseInt(deleteButton.dataset.index, 10);
                    const itemToDelete = deleteButton.dataset.item;
                    showConfirmationModal(`Are you sure you want to delete "${itemToDelete}"?`, () => {
                        dropdownOptions[selectedCategory].splice(itemIndex, 1);
                        saveDropdownOptions();
                        renderCategoryEditor(selectedCategory);
                        updateAllDropdowns();
                        showSuccessModal('Success', `Successfully deleted "${itemToDelete}".`);
                    });
                }
            };
            
            const updateAllDropdowns = () => {
                populateDropdown(obTypeSelect, dropdownOptions.obType);
                populateDropdown(policeStationSelect, dropdownOptions.policeStation);
                populateDropdown(followUpUserSelect, dropdownOptions.followUpUser);
                populateDropdown(areaSelect, dropdownOptions.area);
                // Also populate recoveries dropdowns
                populateDropdown(recoveryVehicleBrandSelect, dropdownOptions.vehicleMake);
                populateDropdown(recoveryPsFromSelect, dropdownOptions.policeStation);
                populateDropdown(recoveryPsRecoveredSelect, dropdownOptions.policeStation);
                populateDropdown(recoveryDivisionSelect, dropdownOptions.division);
                populateDropdown(recoveryTypeSelect, dropdownOptions.recoveryType);
                populateDropdown(recoveryIncidentTypeSelect, dropdownOptions.incidentType);
            };
            
            const handleSaveRecord = () => {
                const actionText = currentRecordAction.charAt(0).toUpperCase() + currentRecordAction.slice(1);
                const obNumber = obNumberDisplay.textContent;
                
                showConfirmationModal(`Are you sure you want to ${currentRecordAction} record OB-${obNumber}?`, () => {
                    // Simulate saving logic
                    let successMessage = `Record OB-${obNumber} has been successfully ${currentRecordAction}d.`;
                    if (currentRecordAction === 'add') {
                        const savedNumber = obCounter;
                        obCounter++;
                        updateObNumberDisplay();
                        successMessage = `Record OB-${savedNumber} has been successfully saved.`
                    }
                    
                    showSuccessModal('Success', successMessage);
                });
            };

            // --- EVENT LISTENERS ---
            sidebarNav.addEventListener('click', (event) => {
                const clickedButton = event.target.closest('button');
                if (!clickedButton || !clickedButton.dataset.view) return;

                sidebarNav.querySelectorAll('button').forEach(btn => {
                    btn.classList.remove('active-btn', 'bg-blue-500', 'text-white');
                    btn.classList.add('bg-gray-200', 'text-gray-700');
                });
                clickedButton.classList.add('active-btn', 'bg-blue-500', 'text-white');
                clickedButton.classList.remove('bg-gray-200', 'text-gray-700');

                showView(clickedButton.dataset.view);
            });
            
            obActionButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    currentRecordAction = btn.dataset.action;
                    obActionButtons.forEach(b => b.classList.remove('action-btn-active', 'bg-blue-500', 'text-white'));
                    btn.classList.add('action-btn-active', 'bg-blue-500', 'text-white');
                });
            });

            statusButtonsContainer.addEventListener('click', (event) => {
                const clickedButton = event.target.closest('.status-btn');
                if (clickedButton) {
                    statusButtonsContainer.querySelectorAll('.status-btn').forEach(btn => {
                        btn.classList.remove('status-btn-active');
                        btn.classList.add('bg-gray-200', 'text-gray-700');
                    });
                    clickedButton.classList.add('status-btn-active');
                    clickedButton.classList.remove('bg-gray-200', 'text-gray-700');
                }
            });

            obForm.addEventListener('input', (event) => {
                const target = event.target;

                // Handle numeric-only fields
                if (target.classList.contains('numeric-only')) {
                    const originalValue = target.value;
                    const numericValue = originalValue.replace(/[^0-9]/g, '');

                    if (originalValue !== numericValue) {
                        target.value = numericValue;
                        showSuccessModal('Invalid Input', 'Only numbers are allowed in this field.');
                    }
                }

                // Handle autosizing for various text inputs
                if (target.matches('#sap-number-input, .autosize-vehicle-input, .autosize-person-input, #contact-no-input')) {
                    autosizeInput(target);
                }

                // Handle autosizing for textareas
                if (target.matches('.autosize-person-textarea')) {
                    autosizeTextarea(target);
                }
            });

            addVehicleBtn.addEventListener('click', () => {
                const newRow = document.createElement('tr');
                const makeOptions = dropdownOptions.vehicleMake.map(make => `<option value="${make}">${make}</option>`).join('');
                newRow.innerHTML = `
                    <td class="border-b p-2"><input type="text" class="autosize-vehicle-input p-1 border rounded-md" placeholder="Registration"></td>
                    <td class="border-b p-2"><select class="vehicle-make-select p-1 border rounded-md">${makeOptions}</select></td>
                    <td class="border-b p-2"><input type="text" class="autosize-vehicle-input p-1 border rounded-md" placeholder="Model"></td>
                    <td class="border-b p-2"><input type="text" class="p-1 border rounded-md w-full" placeholder="Colour"></td>
                    <td class="border-b p-2 text-center"><button type="button" class="remove-row-btn text-red-500 font-bold px-2">X</button></td>
                `;
                suspiciousVehiclesTbody.appendChild(newRow);
                
                const newSelect = newRow.querySelector('.vehicle-make-select');
                autosizeSelect(newSelect);
                
                const newInputs = newRow.querySelectorAll('.autosize-vehicle-input');
                newInputs.forEach(input => autosizeInput(input));
            });

            suspiciousVehiclesTbody.addEventListener('click', (event) => {
                if (event.target.classList.contains('remove-row-btn')) {
                    event.target.closest('tr').remove();
                }
            });

            suspiciousVehiclesTbody.addEventListener('change', (event) => {
                if (event.target.classList.contains('vehicle-make-select')) {
                    autosizeSelect(event.target);
                }
            });

            addPersonBtn.addEventListener('click', () => {
                personRowCounter++; // Increment for a unique name
                const genderName = `gender-${personRowCounter}`;
                const newRow = document.createElement('tr');
                const ethnicityOptions = dropdownOptions.ethnicity.map(e => `<option value="${e}">${e}</option>`).join('');
                newRow.innerHTML = `
                    <td class="border-b p-2"><input type="text" class="autosize-person-input p-1 border rounded-md" placeholder="Firstname"></td>
                    <td class="border-b p-2"><input type="text" class="autosize-person-input p-1 border rounded-md" placeholder="Lastname"></td>
                    <td class="border-b p-2"><input type="text" class="autosize-person-input numeric-only p-1 border rounded-md" placeholder="Age"></td>
                    <td class="border-b p-2"><select class="person-ethnicity-select p-1 border rounded-md">${ethnicityOptions}</select></td>
                    <td class="border-b p-2"><input type="text" class="autosize-person-input p-1 border rounded-md" placeholder="Hair"></td>
                    <td class="border-b p-2"><input type="text" class="autosize-person-input p-1 border rounded-md" placeholder="Eye"></td>
                    <td class="border-b p-2">
                        <div class="flex items-center gap-x-3 p-1">
                            <label class="flex items-center gap-1 text-sm whitespace-nowrap"><input type="radio" name="${genderName}" value="Male">Male</label>
                            <label class="flex items-center gap-1 text-sm whitespace-nowrap"><input type="radio" name="${genderName}" value="Female">Female</label>
                        </div>
                    </td>
                    <td class="border-b p-2"><input type="text" class="autosize-person-input numeric-only p-1 border rounded-md" placeholder="Id"></td>
                    <td class="border-b p-2"><textarea class="autosize-person-textarea p-1 border rounded-md w-full" rows="1" placeholder="Description"></textarea></td>
                    <td class="border-b p-2 text-center"><button type="button" class="remove-row-btn text-red-500 font-bold px-2">X</button></td>
                `;
                personsOfInterestTbody.appendChild(newRow);

                // Initialize autosizing for new elements
                const newEthnicitySelect = newRow.querySelector('.person-ethnicity-select');
                const newInputs = newRow.querySelectorAll('.autosize-person-input');
                const newDescriptionTextarea = newRow.querySelector('.autosize-person-textarea');
                
                autosizeSelect(newEthnicitySelect);
                newInputs.forEach(input => autosizeInput(input));
                autosizeTextarea(newDescriptionTextarea);
            });

            personsOfInterestTbody.addEventListener('click', (event) => {
                if (event.target.classList.contains('remove-row-btn')) {
                    event.target.closest('tr').remove();
                }
            });

            personsOfInterestTbody.addEventListener('change', (event) => {
                if (event.target.classList.contains('person-ethnicity-select')) {
                    autosizeSelect(event.target);
                }
            });


            saveRecordBtn.addEventListener('click', handleSaveRecord);
            
            // Category Editor event listeners
            const categoryEditBtn = document.querySelector('[data-view="category-edit-view"]');
            const categoryEditorView = document.getElementById('category-edit-view');
            const categorySelectorElem = document.getElementById('category-selector');
            const editorPanel = document.getElementById('editor-panel');
            const editingCategoryNameElem = document.getElementById('editing-category-name');
            const categoryItemListElem = document.getElementById('category-item-list');
            const newItemInputElem = document.getElementById('new-item-input');
            const addItemBtnElem = document.getElementById('add-item-btn');
            
            categorySelectorElem.addEventListener('change', () => renderCategoryEditor(categorySelectorElem.value));
            addItemBtnElem.addEventListener('click', handleAddItem);
            newItemInputElem.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleAddItem(); });
            categoryItemListElem.addEventListener('click', handleDeleteItem);

            // --- INITIALIZATION ---
            const initializeApp = () => {
                loadDropdownOptions();
                updateAllDropdowns();
                populateSapDropdowns();
                updateObNumberDisplay();
                autosizeInput(sapNumberInput);
                renderCategoryEditor(categorySelectorElem.value);
            };

            initializeApp();
        });
    </script>
</body>
</html>

