<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Management UI</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for the page */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple animation for button hover */
        .btn-hover-effect {
            transition: all 0.2s ease-in-out;
        }
        .btn-hover-effect:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .active-btn {
            background-color: #3B82F6; /* blue-500 */
            color: white;
        }
        .action-btn-active {
            background-color: #2563EB; /* blue-600 */
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status-btn-active {
            background-color: #10B981; /* green-500 */
            color: white;
        }
        /* Custom scrollbar for category list */
        .category-list::-webkit-scrollbar {
            width: 8px;
        }
        .category-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .category-list::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .category-list::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* Styles for modals */
        .modal-hidden {
            display: none;
        }
        .autosize-person-textarea {
            resize: none;
            overflow-y: hidden;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="modal-hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
        <div class="relative mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Confirm Action</h3>
                <div class="mt-2 px-7 py-3">
                    <p id="confirm-modal-message" class="text-sm text-gray-500"></p>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="modal-confirm-btn" class="px-4 py-2 bg-green-500 text-white text-base font-medium rounded-md w-auto shadow-sm hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-300">
                        Confirm
                    </button>
                    <button id="modal-cancel-btn" class="px-4 py-2 bg-red-500 text-white text-base font-medium rounded-md w-auto ml-2 shadow-sm hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-300">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success/Notification Modal -->
    <div id="success-modal" class="modal-hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
        <div class="relative mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 id="success-modal-title" class="text-lg leading-6 font-medium text-gray-900">Success</h3>
                <div class="mt-2 px-7 py-3">
                    <p id="success-modal-message" class="text-sm text-gray-500"></p>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="success-modal-ok-btn" class="px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md w-auto shadow-sm hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-300">
                        OK
                    </button>
                </div>
            </div>
        </div>
    </div>


    <div class="container mx-auto p-4 md:p-8">
        <div class="flex flex-col md:flex-row bg-white rounded-xl shadow-lg min-h-[80vh]">
            
            <!-- Sidebar Navigation -->
            <aside class="w-full md:w-64 p-6 border-b md:border-b-0 md:border-r border-gray-200">
                <nav id="sidebar-nav" class="space-y-4">
                    <!-- Navigation Button: OB Entry -->
                    <button id="ob-entry-btn" data-view="ob-entry-view" class="w-full flex items-center justify-between p-3 rounded-lg bg-blue-500 text-white font-semibold shadow-md btn-hover-effect">
                        <span>OB Entry</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                    </button>
                    <!-- Navigation Button: Category Edit -->
                    <button data-view="category-edit-view" class="w-full text-left p-3 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">Category Edit</button>
                    
                    <!-- Other Navigation Buttons -->
                    <button data-view="recoveries-view" class="w-full text-left p-3 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">Recoveries</button>
                    <button data-view="complaints-view" class="w-full text-left p-3 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">Complaints</button>
                    <button data-view="positive-arrests-view" class="w-full text-left p-3 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">Positive Arrests</button>
                    <button data-view="add-remove-users-view" class="w-full text-left p-3 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">Add/Remove Users</button>
                </nav>
            </aside>

            <!-- Main Content Area -->
            <main id="main-content" class="flex-1 p-6 md:p-10 overflow-auto">
                <!-- OB Entry View (Now visible by default) -->
                <div id="ob-entry-view" class="view-panel">
                    <div id="ob-actions" class="flex justify-center space-x-4 mb-6">
                        <button data-action="add" class="ob-action-btn px-6 py-2 rounded-lg bg-blue-500 text-white font-semibold shadow-md btn-hover-effect action-btn-active">Add Record</button>
                        <button data-action="remove" class="ob-action-btn px-6 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">Remove Record</button>
                        <button data-action="update" class="ob-action-btn px-6 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">Update Record</button>
                        <button data-action="view" class="ob-action-btn px-6 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">View Record</button>
                    </div>

                    <div class="border rounded-lg p-6 bg-gray-50">
                        <div class="flex justify-between items-center border-b pb-4 mb-6">
                             <h2 class="text-xl font-bold text-gray-800">Occurrence Book (INSERT)</h2>
                             <span class="text-sm font-medium text-gray-600">UID:</span>
                        </div>
                       
                        <form id="ob-form" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">OB Number:</label>
                                    <span id="ob-number-display" class="font-bold text-gray-800"></span>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Created:</label>
                                    <span id="created-date" class="text-gray-800"></span>
                                </div>
                            </div>
                            <div class="grid grid-cols-1">
                                <div class="flex items-center">
                                    <label class="w-48 text-gray-600 font-medium">Time of Incident:</label>
                                    <span class="mr-2">From</span>
                                    <input type="datetime-local" class="p-2 border rounded-md w-full">
                                    <span class="mx-2">To</span>
                                    <input type="datetime-local" class="p-2 border rounded-md w-full">
                                </div>
                            </div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Created By:</label>
                                    <span class="text-gray-800">Mahesh Palad</span>
                                </div>
                            </div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">OB Type<span class="text-red-500">*</span>:</label>
                                    <select id="ob-type-select" class="p-2 border rounded-md w-2/3"></select>
                                </div>
                            </div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">OB Category:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                            </div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Police Station:</label>
                                    <select id="police-station-select" class="p-2 border rounded-md w-2/3"></select>
                                </div>
                            </div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">CAS Number:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                            </div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">SAP 13 Number:</label>
                                    <div class="w-2/3 sap-container">
                                        <input type="text" class="p-2 border rounded-md numeric-only autosize-input w-full mb-2" placeholder="Number">
                                        <div class="flex items-center space-x-2">
                                            <select class="p-2 border rounded-md sap-month"></select>
                                            <span class="text-gray-500">/</span>
                                            <select class="p-2 border rounded-md sap-year"></select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Requires Followup:</label>
                                    <input type="checkbox" class="h-5 w-5">
                                </div>
                            </div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Follow up User:</label>
                                    <select id="follow-up-user-select" class="p-2 border rounded-md w-2/3"></select>
                                </div>
                            </div>
                            
                            <!-- Location Information Section -->
                            <div class="border-t pt-6 mt-6">
                                <h3 class="text-lg font-semibold text-gray-700 mb-4">Location Information</h3>
                                <div class="space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div class="flex items-center">
                                            <label class="w-1/3 text-gray-600 font-medium">Area:</label>
                                            <div class="flex w-2/3">
                                                <select id="area-select" class="p-2 border rounded-md w-full"></select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div class="flex items-center">
                                            <label class="w-1/3 text-gray-600 font-medium">Client:</label>
                                            <div class="flex items-center w-2/3">
                                                <span class="text-gray-800 mr-4">Recorded as Non-Client</span>
                                                <button type="button" class="px-4 py-2 bg-blue-500 text-white rounded-md btn-hover-effect">Lookup</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                        <div class="flex items-center">
                                            <label class="w-1/3 text-gray-600 font-medium">Client Account:</label>
                                            <input type="text" class="p-2 border rounded-md w-2/3">
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                        <div class="flex items-center">
                                            <label class="w-1/3 text-gray-600 font-medium">Contact No:</label>
                                            <input type="text" class="p-2 border rounded-md w-2/3 numeric-only autosize-input">
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 gap-6 bg-blue-50 p-4 rounded-md">
                                         <div class="flex">
                                            <label class="w-1/6 text-gray-600 font-medium">Address:</label>
                                            <div class="w-5/6 space-y-2">
                                                <input type="text" class="p-2 border rounded-md w-full">
                                                <input type="text" class="p-2 border rounded-md w-full">
                                                <input type="text" class="p-2 border rounded-md w-full">
                                            </div>
                                        </div>
                                    </div>
                                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-blue-50 p-4 rounded-md">
                                        <div class="flex items-center">
                                            <label class="w-1/3 text-gray-600 font-medium">Latitude:</label>
                                            <input type="text" class="p-2 border rounded-md w-2/3">
                                        </div>
                                         <div class="flex items-center">
                                            <label class="w-1/3 text-gray-600 font-medium">Longitude:</label>
                                            <input type="text" class="p-2 border rounded-md w-2/3">
                                        </div>
                                    </div>
                                     <div class="grid grid-cols-1 gap-6">
                                         <div class="flex">
                                            <label class="w-1/6 text-gray-600 font-medium">Comments:</label>
                                            <textarea class="p-2 border rounded-md w-5/6 h-24"></textarea>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div class="flex items-center">
                                            <label class="w-1/3 text-gray-600 font-medium">Status:</label>
                                            <div id="status-buttons" class="flex space-x-2">
                                                <button type="button" class="status-btn px-4 py-2 rounded-md bg-gray-200 text-gray-700 status-btn-active">Open</button>
                                                <button type="button" class="status-btn px-4 py-2 rounded-md bg-gray-200 text-gray-700">Closed</button>
                                                <button type="button" class="status-btn px-4 py-2 rounded-md bg-gray-200 text-gray-700">Pending</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Save Button -->
                            <div class="flex justify-end pt-4">
                                <button type="button" id="save-record-btn" class="px-8 py-3 bg-green-500 text-white font-bold rounded-lg shadow-lg btn-hover-effect">Save Record</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Category Edit View -->
                <div id="category-edit-view" class="view-panel hidden">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Category Editor</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <label for="category-selector" class="block text-sm font-medium text-gray-700 mb-2">Select a category to edit:</label>
                            <select id="category-selector" class="w-full p-2 border rounded-md">
                                <option value="obType">OB Type</option>
                                <option value="policeStation">Police Station</option>
                                <option value="followUpUser">Follow up User</option>
                                <option value="area">Area</option>
                                <option value="vehicleMake">Vehicle Make</option>
                                <option value="ethnicity">Ethnicity</option>
                                <option value="division">Division</option>
                                <option value="recoveryType">Recovery Type</option>
                                <option value="incidentType">Incident Type</option>
                                <option value="natureOfCrime">Nature of Crime</option>
                            </select>
                        </div>
                        <div id="editor-panel">
                            <h3 id="editing-category-name" class="text-xl font-semibold mb-4"></h3>
                            <div class="bg-gray-50 border rounded-lg p-4">
                                <div class="mb-4">
                                    <label for="new-item-input" class="block text-sm font-medium text-gray-700">Add new item:</label>
                                    <div class="mt-1 flex rounded-md shadow-sm">
                                        <input type="text" id="new-item-input" class="flex-1 block w-full rounded-none rounded-l-md p-2 border-gray-300" placeholder="New category item">
                                        <button id="add-item-btn" class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 hover:bg-gray-100">Add</button>
                                    </div>
                                </div>
                                <div id="category-item-list" class="category-list max-h-80 overflow-y-auto space-y-2">
                                    <!-- Items will be dynamically inserted here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recoveries View -->
                <div id="recoveries-view" class="view-panel hidden">
                     <div id="recoveries-actions" class="flex justify-center space-x-4 mb-6">
                        <button data-action="add" class="ob-action-btn px-6 py-2 rounded-lg bg-blue-500 text-white font-semibold shadow-md btn-hover-effect action-btn-active">Add Record</button>
                        <button data-action="remove" class="ob-action-btn px-6 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">Remove Record</button>
                        <button data-action="update" class="ob-action-btn px-6 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">Update Record</button>
                        <button data-action="view" class="ob-action-btn px-6 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">View Record</button>
                    </div>
                    <div class="border rounded-lg p-6 bg-gray-50">
                        <h2 class="text-xl font-bold text-gray-800 mb-6 border-b pb-4">Recoveries</h2>
                        <form id="recoveries-form" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Date and Time:</label>
                                    <input type="datetime-local" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Name:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Division:</label>
                                    <select id="recovery-division-select" class="p-2 border rounded-md w-2/3"></select>
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Recovery Type:</label>
                                    <select id="recovery-type-select" class="p-2 border rounded-md w-2/3"></select>
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Incident Type:</label>
                                    <select id="recovery-incident-type-select" class="p-2 border rounded-md w-2/3"></select>
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Duration of Incident:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Registration:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Vin Number:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Items Recovered:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                 <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Quantity of items:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3 numeric-only">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Vehicle Brand:</label>
                                    <select id="recovery-vehicle-brand-select" class="p-2 border rounded-md w-2/3"></select>
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Make of vehicle:</label>
                                     <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Police Station (From):</label>
                                    <select id="recovery-ps-from-select" class="p-2 border rounded-md w-2/3"></select>
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Case number:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Police Station (Recovered):</label>
                                    <select id="recovery-ps-recovered-select" class="p-2 border rounded-md w-2/3"></select>
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">SAPS 13 Number:</label>
                                    <div class="w-2/3 sap-container">
                                        <input type="text" class="p-2 border rounded-md numeric-only autosize-input w-full mb-2" placeholder="Number">
                                        <div class="flex items-center space-x-2">
                                            <select class="p-2 border rounded-md sap-month"></select>
                                            <span class="text-gray-500">/</span>
                                            <select class="p-2 border rounded-md sap-year"></select>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Estimated Value of vehicle:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3 currency-rand">
                                </div>
                                 <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Estimated Value of Items:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3 currency-rand">
                                </div>
                                 <div class="flex items-center col-span-1 md:col-span-2">
                                    <label class="w-1/6 text-gray-600 font-medium">Address Of Incident:</label>
                                    <textarea class="p-2 border rounded-md w-5/6 h-20"></textarea>
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Coordinates (Recovery):</label>
                                    <div class="flex w-2/3 gap-2">
                                        <input type="text" placeholder="Latitude" class="p-2 border rounded-md w-1/2 decimal-only">
                                        <input type="text" placeholder="Longitude" class="p-2 border rounded-md w-1/2 decimal-only">
                                    </div>
                                </div>
                                 <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Marshall OB number:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Recovered by:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Photo of Vehicle Stolen:</label>
                                    <input type="file" class="p-1 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Photo of Items Stolen:</label>
                                    <input type="file" class="p-1 border rounded-md w-2/3">
                                </div>
                            </div>
                             <div class="flex justify-end pt-4">
                                <button type="button" class="px-8 py-3 bg-green-500 text-white font-bold rounded-lg shadow-lg btn-hover-effect">Save Recovery</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div id="complaints-view" class="view-panel hidden flex items-center justify-center h-full border-2 border-dashed border-gray-300 rounded-xl">
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-500">Complaints</h1>
                </div>
                <div id="positive-arrests-view" class="view-panel hidden">
                     <div id="positive-arrests-actions" class="flex justify-center space-x-4 mb-6">
                        <button data-action="add" class="ob-action-btn px-6 py-2 rounded-lg bg-blue-500 text-white font-semibold shadow-md btn-hover-effect action-btn-active">Add Record</button>
                        <button data-action="remove" class="ob-action-btn px-6 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">Remove Record</button>
                        <button data-action="update" class="ob-action-btn px-6 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">Update Record</button>
                        <button data-action="view" class="ob-action-btn px-6 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-blue-100 hover:text-blue-700 font-medium btn-hover-effect">View Record</button>
                    </div>
                    <div class="border rounded-lg p-6 bg-gray-50">
                        <h2 class="text-xl font-bold text-gray-800 mb-6 border-b pb-4">Positive Arrests</h2>
                        <form id="positive-arrests-form" class="space-y-6">
                            <!-- Basic Info -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Date Time Captured:</label>
                                    <input type="datetime-local" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Information Entered by:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Division:</label>
                                    <select id="pa-division-select" class="p-2 border rounded-md w-2/3"></select>
                                </div>
                                <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Date:</label>
                                    <input type="date" class="p-2 border rounded-md w-2/3">
                                </div>
                                <div class="flex items-center col-span-1 md:col-span-2">
                                    <label class="w-1/6 text-gray-600 font-medium">Address of Crime:</label>
                                    <textarea class="p-2 border rounded-md w-5/6 h-20"></textarea>
                                </div>
                            </div>

                            <!-- Crime Details Sections -->
                            <div id="crime-details-container" class="space-y-4">
                                <!-- Crime 1 -->
                                <div class="border-t pt-4 mt-4">
                                     <h3 class="text-lg font-semibold text-gray-700 mb-4">Crime 1</h3>
                                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                         <div class="flex items-center">
                                             <label class="w-1/3 text-gray-600 font-medium">Nature of Crime:</label>
                                             <select class="pa-nature-crime-select p-2 border rounded-md w-2/3"></select>
                                         </div>
                                         <div class="flex items-center">
                                             <label class="w-1/3 text-gray-600 font-medium">Police station:</label>
                                             <select class="pa-police-station-select p-2 border rounded-md w-2/3"></select>
                                         </div>
                                         <div class="flex items-center">
                                             <label class="w-1/3 text-gray-600 font-medium">SAPS Case number:</label>
                                             <input type="text" class="p-2 border rounded-md w-2/3">
                                         </div>
                                         <div class="flex items-center">
                                             <label class="w-1/3 text-gray-600 font-medium">SAPS 13 Number:</label>
                                             <div class="w-2/3 sap-container">
                                                 <input type="text" class="p-2 border rounded-md numeric-only autosize-input w-full mb-2" placeholder="Number">
                                                 <div class="flex items-center space-x-2">
                                                     <select class="p-2 border rounded-md sap-month"></select>
                                                     <span class="text-gray-500">/</span>
                                                     <select class="p-2 border rounded-md sap-year"></select>
                                                 </div>
                                             </div>
                                         </div>
                                     </div>
                                </div>
                                <!-- Crime 2 -->
                                <div class="border-t pt-4 mt-4">
                                     <h3 class="text-lg font-semibold text-gray-700 mb-4">Crime 2</h3>
                                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                         <div class="flex items-center">
                                             <label class="w-1/3 text-gray-600 font-medium">Nature of Crime:</label>
                                             <select class="pa-nature-crime-select p-2 border rounded-md w-2/3"></select>
                                         </div>
                                         <div class="flex items-center">
                                             <label class="w-1/3 text-gray-600 font-medium">Police station:</label>
                                             <select class="pa-police-station-select p-2 border rounded-md w-2/3"></select>
                                         </div>
                                         <div class="flex items-center">
                                             <label class="w-1/3 text-gray-600 font-medium">SAPS Case number:</label>
                                             <input type="text" class="p-2 border rounded-md w-2/3">
                                         </div>
                                         <div class="flex items-center">
                                             <label class="w-1/3 text-gray-600 font-medium">SAPS 13 Number:</label>
                                             <div class="w-2/3 sap-container">
                                                 <input type="text" class="p-2 border rounded-md numeric-only autosize-input w-full mb-2" placeholder="Number">
                                                 <div class="flex items-center space-x-2">
                                                     <select class="p-2 border rounded-md sap-month"></select>
                                                     <span class="text-gray-500">/</span>
                                                     <select class="p-2 border rounded-md sap-year"></select>
                                                 </div>
                                             </div>
                                         </div>
                                     </div>
                                </div>
                                <!-- Crime 3 -->
                                <div class="border-t pt-4 mt-4">
                                     <h3 class="text-lg font-semibold text-gray-700 mb-4">Crime 3</h3>
                                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                         <div class="flex items-center">
                                             <label class="w-1/3 text-gray-600 font-medium">Nature of Crime:</label>
                                             <select class="pa-nature-crime-select p-2 border rounded-md w-2/3"></select>
                                         </div>
                                         <div class="flex items-center">
                                             <label class="w-1/3 text-gray-600 font-medium">Police station:</label>
                                             <select class="pa-police-station-select p-2 border rounded-md w-2/3"></select>
                                         </div>
                                         <div class="flex items-center">
                                             <label class="w-1/3 text-gray-600 font-medium">SAPS Case number:</label>
                                             <input type="text" class="p-2 border rounded-md w-2/3">
                                         </div>
                                         <div class="flex items-center">
                                             <label class="w-1/3 text-gray-600 font-medium">SAPS 13 Number:</label>
                                             <div class="w-2/3 sap-container">
                                                 <input type="text" class="p-2 border rounded-md numeric-only autosize-input w-full mb-2" placeholder="Number">
                                                 <div class="flex items-center space-x-2">
                                                     <select class="p-2 border rounded-md sap-month"></select>
                                                     <span class="text-gray-500">/</span>
                                                     <select class="p-2 border rounded-md sap-year"></select>
                                                 </div>
                                             </div>
                                         </div>
                                     </div>
                                </div>
                                <!-- Crime 4 -->
                                <div class="border-t pt-4 mt-4">
                                     <h3 class="text-lg font-semibold text-gray-700 mb-4">Crime 4</h3>
                                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                         <div class="flex items-center">
                                             <label class="w-1/3 text-gray-600 font-medium">Nature of Crime:</label>
                                             <select class="pa-nature-crime-select p-2 border rounded-md w-2/3"></select>
                                         </div>
                                         <div class="flex items-center">
                                             <label class="w-1/3 text-gray-600 font-medium">Police station:</label>
                                             <select class="pa-police-station-select p-2 border rounded-md w-2/3"></select>
                                         </div>
                                         <div class="flex items-center">
                                             <label class="w-1/3 text-gray-600 font-medium">SAPS Case number:</label>
                                             <input type="text" class="p-2 border rounded-md w-2/3">
                                         </div>
                                         <div class="flex items-center">
                                             <label class="w-1/3 text-gray-600 font-medium">SAPS 13 Number:</label>
                                             <div class="w-2/3 sap-container">
                                                 <input type="text" class="p-2 border rounded-md numeric-only autosize-input w-full mb-2" placeholder="Number">
                                                 <div class="flex items-center space-x-2">
                                                     <select class="p-2 border rounded-md sap-month"></select>
                                                     <span class="text-gray-500">/</span>
                                                     <select class="p-2 border rounded-md sap-year"></select>
                                                 </div>
                                             </div>
                                         </div>
                                     </div>
                                </div>
                            </div>

                             <!-- Pictures Section -->
                            <div class="border-t pt-4 mt-4">
                                <h3 class="text-lg font-semibold text-gray-700 mb-4">Evidence Pictures</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="flex items-center">
                                        <label class="w-1/3 text-gray-600 font-medium">Pictures of Scene:</label>
                                        <input type="file" multiple class="p-1 border rounded-md w-2/3">
                                    </div>
                                    <div class="flex items-center">
                                        <label class="w-1/3 text-gray-600 font-medium">Picture of Statement:</label>
                                        <input type="file" class="p-1 border rounded-md w-2/3">
                                    </div>
                                     <div class="flex items-center">
                                        <label class="w-1/3 text-gray-600 font-medium">Picture of Statement 2:</label>
                                        <input type="file" class="p-1 border rounded-md w-2/3">
                                    </div>
                                     <div class="flex items-center">
                                        <label class="w-1/3 text-gray-600 font-medium">Picture of Statement 3:</label>
                                        <input type="file" class="p-1 border rounded-md w-2/3">
                                    </div>
                                     <div class="flex items-center">
                                        <label class="w-1/3 text-gray-600 font-medium">Picture of Statement 4:</label>
                                        <input type="file" class="p-1 border rounded-md w-2/3">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Suspects Section -->
                            <div class="border-t pt-4 mt-4">
                                <h3 class="text-lg font-semibold text-gray-700 mb-4">Suspect Details</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                                     <div class="flex items-center">
                                        <label class="w-1/3 text-gray-600 font-medium">Total Suspects:</label>
                                        <input type="text" class="p-2 border rounded-md w-2/3 numeric-only">
                                    </div>
                                </div>
                                <div class="flex justify-end mb-2">
                                    <button type="button" id="add-suspect-btn" class="px-4 py-2 bg-blue-500 text-white rounded-md btn-hover-effect">Add Suspect</button>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full bg-white border">
                                        <thead class="bg-gray-200">
                                            <tr>
                                                <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">Suspect Name</th>
                                                <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">ID Number</th>
                                                <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">ID Picture</th>
                                                <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="suspects-tbody"></tbody>
                                    </table>
                                </div>
                            </div>

                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pt-4">
                                 <div class="flex items-center">
                                    <label class="w-1/3 text-gray-600 font-medium">Arrested By:</label>
                                    <input type="text" class="p-2 border rounded-md w-2/3">
                                </div>
                             </div>

                             <div class="flex justify-end pt-4">
                                <button type="button" class="px-8 py-3 bg-green-500 text-white font-bold rounded-lg shadow-lg btn-hover-effect">Save Arrest</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div id="add-remove-users-view" class="view-panel hidden flex items-center justify-center h-full border-2 border-dashed border-gray-300 rounded-xl">
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-500">Add/Remove Users</h1>
                </div>
            </main>
        </div>
    </div>

    <script>
        // Immediately hide modals to prevent flash on load
        document.getElementById('confirmation-modal').style.display = 'none';
        document.getElementById('success-modal').style.display = 'none';

        document.addEventListener('DOMContentLoaded', () => {
            // --- STATE MANAGEMENT ---
            let obCounter = 1;
            let currentRecordAction = 'add'; // Default action
            let dropdownOptions; // Will be loaded from localStorage or defaults
            let personRowCounter = 0;

            const toSentenceCase = (str) => {
                if (typeof str !== 'string' || str.length === 0) return str;
                let lowerCaseStr = str.toLowerCase();
                return lowerCaseStr.charAt(0).toUpperCase() + lowerCaseStr.slice(1);
            };

            // Default data structure in case localStorage is empty
            const defaultDropdownOptions = {
                obType: [
                    "Abduction", "Accident", "Accident/injury", "Accidental discharge of firearm", "Alarm activations", "Armed robbery", 
                    "Armed robbery with shooting incident", "Arrest and recovery", "Arrest of suspect/s", "Arson - fire", "Assault", "Atm crimes", 
                    "Attack on person/persons", "Attemped theft out of motor vehicle", "Attempted armed robbery", "Attempted business breaking", 
                    "Attempted business robbery", "Attempted entry in complex via fence/gate", "Attempted hi jacking", "Attempted house breaking with theft", 
                    "Attempted house breaking without theft", "Attempted house robbery", "Attempted kidnapping", "Attempted mugging", "Attempted murder", 
                    "Attempted rape", "Attempted remote jamming", "Attempted suicide", "Attempted theft", "Attempted theft of motor vehicle", "Audit finding", 
                    "Audit findings", "Aura responses", "Bicycle repairs", "Booking off", "Business breaking", "Business robbery", "Cctv malfunction on site", 
                    "Client complaint", "Common robbery", "Common theft", "Culpable homicide", "Damage on site", "Disciplinary", "Disturbance on site", 
                    "Domestic issue", "Door left unlocked/open", "Drinking in public", "Driving under the influence", "Drowning", "Drunk driving"
                ],
                policeStation: [
                    "Alexandra road", "Amangwe/loskop", "Amanzimtoti", "Babanango", "Bayview", "Bellair", "Berea", "Bergville", "Besters", "Bhekithemba", 
                    "Bishopstowe", "Boston", "Brighton beach", "Bulwer", "Camperdown", "Cato manor", "Ceza", "Charlestown", "Chatsworth", "Colenso", "Cramond", 
                    "Creighton", "Dalton", "Dannhauser", "Donnybrook", "Dududu", "Dundee", "Durban central", "Durban harbour", "Durban north", "Ekombe", "Ekuvukeni", 
                    "Elandslaagte", "Emanguzi", "Ematimatolo", "Ematsheni", "Emondlo", "Empangeni", "Eshowe", "Esikhawini", "Estcourt", "Evatt", "Ezakheni", 
                    "Ezibayeni", "Ezinqoleni", "Folweni", "Franklin", "Gamalakhe", "Gingindlovu", "Glencoe", "Glendale", "Gluckstadt", "Gowan lea", "Greenwood park", 
                    "Greytown", "Groenvlei", "Hammersdale", "Harburg", "Harding", "Hattingspruit", "Helpmekaar", "Hibberdene", "Highflats", "Hillcrest", "Hilton-kzn", 
                    "Himeville", "Hlabisa", "Hlobane", "Hluhluwe", "Howick", "Ibisi", "Impendle", "Inanda", "Inchanga", "Ingogo", "Ingwavuma", "Intsikeni", "Isipingo", 
                    "Ixopo", "Jozini", "King shaka international airport", "Kingsley", "Kokstad", "Kranskop", "Kwa dabeka", "Kwamashu e", "Kwadukuza", "Kwamakutha", 
                    "Kwambonambi", "Kwamsane", "Kwandengezi", "Ladysmith", "Lamontville", "Louwsburg", "Madadeni", "Magudu", "Mahlabathini", "Malvern", "Mandeni", 
                    "Maphumulo", "Margate", "Mariannhill", "Mayville", "Mbazwana", "Mbongolwane", "Mehlomnyama", "Melmoth", "Mid illovo", "Mkuze", "Mondlo", "Montclair", 
                    "Mooi rivier", "Mountain rise", "Mpophomeni", "Mpumalanga-kzn", "Mpungamhlophe", "Msinga", "Msinsini", "Mtubatuba", "Mtunzini", "Muden", "Ndumo", 
                    "Ndwedwe", "New hanover", "Newcastle", "Ngome", "Ngwavuma", "Nkandla", "Nongoma", "Nqutu", "Nottingham road", "Okhahlamba", "Oribi", "Paulpietersburg", 
                    "Plessislaer", "Point", "Pomeroy", "Pongola", "Port edward", "Port shepstone", "Prestbury", "Richards bay", "Richmond-kzn", "Rietvlei", "Sawoti", 
                    "Scottburgh", "Stanger", "Sundumbili", "Swartberg", "Sydenham", "Taylors halt", "Thornville", "Tongaat", "Town hill", "Tugela ferry", "Ubombo", 
                    "Umbilo", "Umhlali", "Umkomaas", "Umlazi", "Umsinga", "Umzinto", "Umzinto north", "Underberg", "Utrecht", "Van reenen", "Verulam", "Vryheid", 
                    "Wartburg", "Weenen", "Wentworth", "Westville"
                ],
                followUpUser: ["Admin", "Operator 1", "Investigator"],
                area: [
                    "Amaoti", "Athlone", "Avoca", "Avoca hills", "Ballito", "Bellair", "Berea", "Bluff", "Briardene", "Chesterville", "Claremont", "Cornubia", 
                    "Durban central", "Durban north", "Effingham", "Glen anil", "Glen hills", "Glenashley", "Greenwood park", "Herwood park", "Inanda", "Izinga ridge", 
                    "Kenville", "Kwa mashu", "La lucia", "La lucia ridge", "Lower la lucia", "Lower umhlanga", "M4 southern freeway", "Maphumulo", "Morningside", 
                    "Mount edgecombe", "Mount moriah", "N2 freeway", "N2/m7 freeway", "Ndwedwe", "Newlands east", "Newlands west", "Nkandla", "Ntuzumu", "Park hill", 
                    "Phoenix", "Pinetown", "Prestondale", "Red hill", "Richmond", "Riverhorse valley", "Rosehill", "Salt rock", "Savanah park", "Seacowlake", 
                    "Sheffield beach", "Sherwood", "Somerset park", "South lying areas", "Springfield", "Springfield park", "Stamfordhill", "Sunningdale", "Umdloti", 
                    "Umgeni park", "Umhlali", "Umhlanga", "Umhlanga manors", "Umhlanga ridge", "Verulam", "Virginia", "Westbrook", "Westmead - sector one", 
                    "Westmead sector two", "Westville", "Wyebank"
                ],
                vehicleMake: [
                    "Volkswagen", "Toyota", "Hyundai", "Isuzu", "Nissan", "Alfa romeo", "Audi", "Bmw", "Chery", "Chevrolet", "Chrysler", "Citroen", "Datsun", "Dodge", "Fiat", "Ford", "Haval", "Honda", "Infiniti", "Jaguar", "Jeep", "Kia", "Landrover", "Lexus", "Mahindra", "Mazda", "Mercedes-benz", "Mini", "Mitsubishi", "Opel", "Peugeot", "Renault", "Saab", "Scion", "Seat", "Skoda", "Subaru", "Suzuki", "Volvo"
                ],
                ethnicity: [ "Asian", "Black", "Coloured", "Indian", "White", "Other"],
                division: ["Sot", "Reaction", "Westmead (sector 1)", "Westmead (sector 2)"],
                recoveryType: ["Vehicle", "Items"],
                incidentType: ["Hijacked", "Stolen", "Missing person", "House breaking", "Snipr", "Fraud", "Theft"],
                natureOfCrime: [
                    "Damage to property (mi2p)", "Section 36 ( possession of stolen property )", "Theft of cellphone", "Theft", "Trespassing", "Attempted house breaking", "House robbery",
                    "Armed robbery", "House breaking without theft", "Business robbery", "Theft of copper", "Theft of petrol", "Fraud/counterfeit money", "Murder", "Assault",
                    "Damage to property", "Robbery", "Attempted murder", "Hijacking", "Rape", "House breaking", "In possession off illegal firearm and ammunition",
                    "In possession off illegal firearm", "In possession off illegal ammunition", "Common robbery", "Business breakin and theft", "Attempted theft out of mv",
                    "Theft out of mv", "Attempted theft from mv", "Theft from mv", "In possession of car breaking implements", "Fraud", "Facial reg app"
                ]
            };
            
            // --- ELEMENT REFERENCES ---
            const sidebarNav = document.getElementById('sidebar-nav');
            const viewPanels = document.querySelectorAll('.view-panel');
            const obNumberDisplay = document.getElementById('ob-number-display');
            const obActionButtons = document.querySelectorAll('.ob-action-btn');
            const saveRecordBtn = document.getElementById('save-record-btn');
            const obTypeSelect = document.getElementById('ob-type-select');
            const policeStationSelect = document.getElementById('police-station-select');
            const followUpUserSelect = document.getElementById('follow-up-user-select');
            const areaSelect = document.getElementById('area-select');
            const categorySelector = document.getElementById('category-selector');
            const editingCategoryName = document.getElementById('editing-category-name');
            const categoryItemList = document.getElementById('category-item-list');
            const newItemInput = document.getElementById('new-item-input');
            const addItemBtn = document.getElementById('add-item-btn');
            const createdDateEl = document.getElementById('created-date');
            const statusButtonsContainer = document.getElementById('status-buttons');
            const addVehicleBtn = document.getElementById('add-vehicle-btn');
            const suspiciousVehiclesTbody = document.getElementById('suspicious-vehicles-tbody');
            const addPersonBtn = document.getElementById('add-person-btn');
            const personsOfInterestTbody = document.getElementById('persons-of-interest-tbody');
            const recoveryVehicleBrandSelect = document.getElementById('recovery-vehicle-brand-select');
            const recoveryPsFromSelect = document.getElementById('recovery-ps-from-select');
            const recoveryPsRecoveredSelect = document.getElementById('recovery-ps-recovered-select');
            const recoveryDivisionSelect = document.getElementById('recovery-division-select');
            const recoveryTypeSelect = document.getElementById('recovery-type-select');
            const recoveryIncidentTypeSelect = document.getElementById('recovery-incident-type-select');
            const addSuspectBtn = document.getElementById('add-suspect-btn');
            const suspectsTbody = document.getElementById('suspects-tbody');


            // Modal References
            const confirmModal = document.getElementById('confirmation-modal');
            const confirmModalMessage = document.getElementById('confirm-modal-message');
            const modalConfirmBtn = document.getElementById('modal-confirm-btn');
            const modalCancelBtn = document.getElementById('modal-cancel-btn');
            
            const successModal = document.getElementById('success-modal');
            const successModalTitle = document.getElementById('success-modal-title');
            const successModalMessage = document.getElementById('success-modal-message');
            const successModalOkBtn = document.getElementById('success-modal-ok-btn');

            // --- FUNCTIONS ---

            const showConfirmationModal = (message, onConfirmCallback) => {
                confirmModalMessage.textContent = message;
                confirmModal.style.display = 'flex'; // Use flex to center it
                const newConfirmBtn = modalConfirmBtn.cloneNode(true);
                modalConfirmBtn.parentNode.replaceChild(newConfirmBtn, modalConfirmBtn);
                newConfirmBtn.addEventListener('click', () => {
                    confirmModal.style.display = 'none';
                    onConfirmCallback();
                });
            };
            
            modalCancelBtn.addEventListener('click', () => confirmModal.style.display = 'none');

            const showSuccessModal = (title, message) => {
                successModalTitle.textContent = title;
                successModalMessage.textContent = message;
                successModal.style.display = 'flex'; // Use flex to center it
            };

            successModalOkBtn.addEventListener('click', () => successModal.style.display = 'none');

            const saveDropdownOptions = () => localStorage.setItem('dropdownData', JSON.stringify(dropdownOptions));
            
            const loadDropdownOptions = () => {
                const savedData = localStorage.getItem('dropdownData');
                const savedOptions = savedData ? JSON.parse(savedData) : {};
                
                let tempOptions = {};

                // Start with a deep copy of defaults
                let defaultCopy = JSON.parse(JSON.stringify(defaultDropdownOptions));

                // Format all default category items
                for (const key in defaultCopy) {
                    if (Array.isArray(defaultCopy[key])) {
                        defaultCopy[key] = defaultCopy[key].map(item => toSentenceCase(item));
                    }
                }
                
                dropdownOptions = { ...defaultCopy, ...savedOptions };

                 // Ensure saved data is also formatted
                for (const key in dropdownOptions) {
                    if (Array.isArray(dropdownOptions[key])) {
                        dropdownOptions[key] = dropdownOptions[key].map(item => toSentenceCase(item));
                    }
                }
            };
            
            const showView = (viewId) => {
                viewPanels.forEach(panel => {
                    panel.id === viewId ? panel.classList.remove('hidden') : panel.classList.add('hidden');
                });
                if (viewId === 'ob-entry-view') updateObNumberDisplay();
            };

            const populateDropdown = (selectElement, options, placeholder) => {
                if (!selectElement) return;
                selectElement.innerHTML = '';
                
                // Add a disabled, selected placeholder option
                const placeholderOpt = document.createElement('option');
                placeholderOpt.value = "";
                placeholderOpt.textContent = placeholder || "No Selection";
                placeholderOpt.disabled = true;
                placeholderOpt.selected = true;
                selectElement.appendChild(placeholderOpt);

                options.forEach((optionText) => {
                    const option = document.createElement('option');
                    option.value = optionText;
                    option.textContent = optionText;
                    selectElement.appendChild(option);
                });
            };
            
            const populateSapDropdowns = (monthSelect, yearSelect) => {
                if (!monthSelect || !yearSelect) return;
                // Populate months
                const months = ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12'];
                monthSelect.innerHTML = '';
                months.forEach(month => {
                    const option = document.createElement('option');
                    option.value = month;
                    option.textContent = month;
                    monthSelect.appendChild(option);
                });

                // Populate years
                const currentYear = new Date().getFullYear();
                yearSelect.innerHTML = '';
                for (let i = 0; i < 10; i++) {
                    const year = currentYear + i;
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    yearSelect.appendChild(option);
                }
            };
            
            const autosizeInput = (inputElement) => {
                if (!inputElement) return;
                const tempSpan = document.createElement('span');
                tempSpan.style.visibility = 'hidden';
                tempSpan.style.position = 'absolute';
                tempSpan.style.whiteSpace = 'nowrap';
                tempSpan.style.font = window.getComputedStyle(inputElement).font;
                
                tempSpan.textContent = inputElement.value || inputElement.placeholder;
                
                document.body.appendChild(tempSpan);
                const width = tempSpan.offsetWidth;
                document.body.removeChild(tempSpan);

                // Set a minimum width and add padding
                inputElement.style.width = `${Math.max(60, width + 20)}px`;
            };

            const autosizeSelect = (selectElement) => {
                if (!selectElement) return;
                // Create a hidden span to measure text width
                const tempSpan = document.createElement('span');
                tempSpan.style.visibility = 'hidden';
                tempSpan.style.position = 'absolute';
                tempSpan.style.whiteSpace = 'nowrap';
                tempSpan.style.font = window.getComputedStyle(selectElement).font;
                
                let maxWidth = 0;
                document.body.appendChild(tempSpan);
                for (let i = 0; i < selectElement.options.length; i++) {
                    tempSpan.textContent = selectElement.options[i].textContent;
                    maxWidth = Math.max(maxWidth, tempSpan.offsetWidth);
                }
                document.body.removeChild(tempSpan);

                // Add some padding for the dropdown arrow and to prevent text clipping
                selectElement.style.width = `${maxWidth + 40}px`;
            };

            const autosizeTextarea = (textarea) => {
                if (!textarea) return;
                textarea.style.height = 'auto'; // Reset height
                textarea.style.height = textarea.scrollHeight + 'px'; // Set to scroll height
            }

            const renderCategoryEditor = (categoryKey) => {
                const categoryData = dropdownOptions[categoryKey] || [];
                editingCategoryName.textContent = `Editing: ${categorySelector.options[categorySelector.selectedIndex].text}`;
                categoryItemList.innerHTML = '';
                categoryData.forEach((item, index) => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'flex justify-between items-center p-2 bg-white rounded-md shadow-sm';
                    itemDiv.innerHTML = `
                        <span class="flex-grow">${item}</span>
                        <button data-item="${item}" data-index="${index}" class="text-red-500 hover:text-red-700 font-bold delete-item-btn p-1">X</button>
                    `;
                    categoryItemList.appendChild(itemDiv);
                });
            };

            const updateObNumberDisplay = () => {
                if (obNumberDisplay) {
                    obNumberDisplay.textContent = obCounter;
                }
                if(createdDateEl){
                    createdDateEl.textContent = new Date().toLocaleString();
                }
            };

            const handleAddItem = () => {
                const selectedCategory = categorySelector.value;
                const newItem = newItemInput.value.trim();
                if (newItem && !dropdownOptions[selectedCategory].includes(newItem)) {
                    showConfirmationModal(`Are you sure you want to add "${newItem}"?`, () => {
                        dropdownOptions[selectedCategory].push(toSentenceCase(newItem));
                        saveDropdownOptions();
                        renderCategoryEditor(selectedCategory);
                        updateAllDropdowns();
                        newItemInput.value = '';
                        showSuccessModal('Success', `Successfully added "${newItem}".`);
                    });
                } else if (newItem) {
                    showSuccessModal('Error', `Item "${newItem}" already exists in this category.`);
                }
            };

            const handleDeleteItem = (event) => {
                const deleteButton = event.target.closest('.delete-item-btn');
                if (deleteButton) {
                    const selectedCategory = categorySelector.value;
                    const itemIndex = parseInt(deleteButton.dataset.index, 10);
                    const itemToDelete = deleteButton.dataset.item;
                    showConfirmationModal(`Are you sure you want to delete "${itemToDelete}"?`, () => {
                        dropdownOptions[selectedCategory].splice(itemIndex, 1);
                        saveDropdownOptions();
                        renderCategoryEditor(selectedCategory);
                        updateAllDropdowns();
                        showSuccessModal('Success', `Successfully deleted "${itemToDelete}".`);
                    });
                }
            };
            
            const updateAllDropdowns = () => {
                populateDropdown(obTypeSelect, dropdownOptions.obType, 'No OB Type Selected');
                populateDropdown(policeStationSelect, dropdownOptions.policeStation, 'No Police Station Selected');
                populateDropdown(followUpUserSelect, dropdownOptions.followUpUser, 'No User Selected');
                populateDropdown(areaSelect, dropdownOptions.area, 'No Area Selected');
                populateDropdown(recoveryVehicleBrandSelect, dropdownOptions.vehicleMake, 'No Vehicle Brand Selected');
                populateDropdown(recoveryPsFromSelect, dropdownOptions.policeStation, 'No Police Station Selected');
                populateDropdown(recoveryPsRecoveredSelect, dropdownOptions.policeStation, 'No Police Station Selected');
                populateDropdown(recoveryDivisionSelect, dropdownOptions.division, 'No Division Selected');
                populateDropdown(recoveryTypeSelect, dropdownOptions.recoveryType, 'No Recovery Type Selected');
                populateDropdown(recoveryIncidentTypeSelect, dropdownOptions.incidentType, 'No Incident Type Selected');
                populateDropdown(document.getElementById('pa-division-select'), dropdownOptions.division, 'No Division Selected');
                document.querySelectorAll('.pa-nature-crime-select').forEach(select => populateDropdown(select, dropdownOptions.natureOfCrime, 'No Crime Selected'));
                document.querySelectorAll('.pa-police-station-select').forEach(select => populateDropdown(select, dropdownOptions.policeStation, 'No Police Station Selected'));
                
                document.querySelectorAll('select').forEach(select => autosizeSelect(select));
            };
            
            const handleSaveRecord = () => {
                const actionText = currentRecordAction.charAt(0).toUpperCase() + currentRecordAction.slice(1);
                const obNumber = obNumberDisplay.textContent;
                
                showConfirmationModal(`Are you sure you want to ${currentRecordAction} record OB-${obNumber}?`, () => {
                    // Simulate saving logic
                    let successMessage = `Record OB-${obNumber} has been successfully ${currentRecordAction}d.`;
                    if (currentRecordAction === 'add') {
                        const savedNumber = obCounter;
                        obCounter++;
                        updateObNumberDisplay();
                        successMessage = `Record OB-${savedNumber} has been successfully saved.`
                    }
                    
                    showSuccessModal('Success', successMessage);
                });
            };

            // --- EVENT LISTENERS ---
            sidebarNav.addEventListener('click', (event) => {
                const clickedButton = event.target.closest('button');
                if (!clickedButton || !clickedButton.dataset.view) return;

                sidebarNav.querySelectorAll('button').forEach(btn => {
                    btn.classList.remove('active-btn', 'bg-blue-500', 'text-white');
                    btn.classList.add('bg-gray-200', 'text-gray-700');
                });
                clickedButton.classList.add('active-btn', 'bg-blue-500', 'text-white');
                clickedButton.classList.remove('bg-gray-200', 'text-gray-700');

                showView(clickedButton.dataset.view);
            });
            
            obActionButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    currentRecordAction = btn.dataset.action;
                    obActionButtons.forEach(b => b.classList.remove('action-btn-active', 'bg-blue-500', 'text-white'));
                    btn.classList.add('action-btn-active', 'bg-blue-500', 'text-white');
                });
            });

            if (statusButtonsContainer) {
                statusButtonsContainer.addEventListener('click', (event) => {
                    const clickedButton = event.target.closest('.status-btn');
                    if (clickedButton) {
                        statusButtonsContainer.querySelectorAll('.status-btn').forEach(btn => {
                            btn.classList.remove('status-btn-active');
                            btn.classList.add('bg-gray-200', 'text-gray-700');
                        });
                        clickedButton.classList.add('status-btn-active');
                        clickedButton.classList.remove('bg-gray-200', 'text-gray-700');
                    }
                });
            }

            document.body.addEventListener('input', (event) => {
                const target = event.target;

                // Handle numeric-only fields
                if (target.classList.contains('numeric-only')) {
                    const originalValue = target.value;
                    const numericValue = originalValue.replace(/[^0-9]/g, '');

                    if (originalValue !== numericValue) {
                        target.value = numericValue;
                        // showSuccessModal('Invalid Input', 'Only numbers are allowed in this field.');
                    }
                }
                // Handle currency formatting
                else if (target.classList.contains('currency-rand')) {
                    const originalValue = target.value;
                    let numericValue = originalValue.replace(/[^0-9]/g, '');

                    if (numericValue) {
                        const number = parseInt(numericValue, 10);
                        const formattedValue = 'R ' + number.toLocaleString('en-ZA');
                        
                        if (target.value !== formattedValue) {
                            target.value = formattedValue;
                        }
                    } else {
                        target.value = ''; // Clear if no numbers
                    }
                }
                 // Handle decimal-only fields for coordinates
                else if (target.classList.contains('decimal-only')) {
                    const originalValue = target.value;
                    let sanitizedValue = originalValue.replace(/[^0-9.-]/g, ''); // Remove invalid chars

                    // Ensure hyphen is only at the beginning
                    if (sanitizedValue.indexOf('-', 1) > -1) {
                         sanitizedValue = '-' + sanitizedValue.replace(/-/g, '');
                    }

                    // Ensure only one decimal point
                    const parts = sanitizedValue.split('.');
                    if (parts.length > 2) {
                        sanitizedValue = parts[0] + '.' + parts.slice(1).join('');
                    }
                    
                    if (sanitizedValue !== originalValue) {
                         target.value = sanitizedValue;
                         // showSuccessModal('Invalid Input', 'Only decimal numbers are allowed.');
                    }
                }


                // Handle autosizing for various text inputs
                if (target.classList.contains('autosize-input')) {
                    autosizeInput(target);
                }

                // Handle autosizing for textareas
                if (target.matches('.autosize-person-textarea')) {
                    autosizeTextarea(target);
                }
            });

            document.body.addEventListener('change', (event) => {
                if (event.target.tagName === 'SELECT') {
                    autosizeSelect(event.target);
                }
            });


            if (addVehicleBtn) {
                addVehicleBtn.addEventListener('click', () => {
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td class="border-b p-2"><input type="text" class="autosize-input p-1 border rounded-md" placeholder="Registration"></td>
                        <td class="border-b p-2"><select class="vehicle-make-select p-1 border rounded-md"></select></td>
                        <td class="border-b p-2"><input type="text" class="autosize-input p-1 border rounded-md" placeholder="Model"></td>
                        <td class="border-b p-2"><input type="text" class="p-1 border rounded-md w-full" placeholder="Colour"></td>
                        <td class="border-b p-2 text-center"><button type="button" class="remove-row-btn text-red-500 font-bold px-2">X</button></td>
                    `;
                    suspiciousVehiclesTbody.appendChild(newRow);
                    
                    const newSelect = newRow.querySelector('.vehicle-make-select');
                    populateDropdown(newSelect, dropdownOptions.vehicleMake, 'No vehicle selected');
                    autosizeSelect(newSelect);
                    
                    const newInputs = newRow.querySelectorAll('.autosize-input');
                    newInputs.forEach(input => autosizeInput(input));
                });
            }

            if (suspiciousVehiclesTbody) {
                suspiciousVehiclesTbody.addEventListener('click', (event) => {
                    if (event.target.classList.contains('remove-row-btn')) {
                        event.target.closest('tr').remove();
                    }
                });
            }

            if (addPersonBtn) {
                addPersonBtn.addEventListener('click', () => {
                    personRowCounter++; // Increment for a unique name
                    const genderName = `gender-${personRowCounter}`;
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td class="border-b p-2"><input type="text" class="autosize-input p-1 border rounded-md" placeholder="Firstname"></td>
                        <td class="border-b p-2"><input type="text" class="autosize-input p-1 border rounded-md" placeholder="Lastname"></td>
                        <td class="border-b p-2"><input type="text" class="autosize-input numeric-only p-1 border rounded-md" placeholder="Age"></td>
                        <td class="border-b p-2"><select class="person-ethnicity-select p-1 border rounded-md"></select></td>
                        <td class="border-b p-2"><input type="text" class="autosize-input p-1 border rounded-md" placeholder="Hair"></td>
                        <td class="border-b p-2"><input type="text" class="autosize-input p-1 border rounded-md" placeholder="Eye"></td>
                        <td class="border-b p-2">
                            <div class="flex items-center gap-x-3 p-1">
                                <label class="flex items-center gap-1 text-sm whitespace-nowrap"><input type="radio" name="${genderName}" value="Male">Male</label>
                                <label class="flex items-center gap-1 text-sm whitespace-nowrap"><input type="radio" name="${genderName}" value="Female">Female</label>
                            </div>
                        </td>
                        <td class="border-b p-2"><input type="text" class="autosize-input numeric-only p-1 border rounded-md" placeholder="Id"></td>
                        <td class="border-b p-2"><textarea class="autosize-person-textarea p-1 border rounded-md w-full" rows="1" placeholder="Description"></textarea></td>
                        <td class="border-b p-2 text-center"><button type="button" class="remove-row-btn text-red-500 font-bold px-2">X</button></td>
                    `;
                    personsOfInterestTbody.appendChild(newRow);

                    // Initialize autosizing for new elements
                    const newEthnicitySelect = newRow.querySelector('.person-ethnicity-select');
                    populateDropdown(newEthnicitySelect, dropdownOptions.ethnicity, 'No Ethnicity Selected');
                    autosizeSelect(newEthnicitySelect);

                    const newInputs = newRow.querySelectorAll('.autosize-input');
                    newInputs.forEach(input => autosizeInput(input));

                    const newDescriptionTextarea = newRow.querySelector('.autosize-person-textarea');
                    autosizeTextarea(newDescriptionTextarea);
                });
            }

            if (personsOfInterestTbody) {
                personsOfInterestTbody.addEventListener('click', (event) => {
                    if (event.target.classList.contains('remove-row-btn')) {
                        event.target.closest('tr').remove();
                    }
                });
            }

            if(saveRecordBtn) saveRecordBtn.addEventListener('click', handleSaveRecord);
            
            // Category Editor event listeners
            const categorySelectorElem = document.getElementById('category-selector');
            const newItemInputElem = document.getElementById('new-item-input');
            const addItemBtnElem = document.getElementById('add-item-btn');
            const categoryItemListElem = document.getElementById('category-item-list');
            
            if (categorySelectorElem) {
                 categorySelectorElem.addEventListener('change', () => renderCategoryEditor(categorySelectorElem.value));
            }
            if(addItemBtnElem) {
                addItemBtnElem.addEventListener('click', handleAddItem);
            }
            if(newItemInputElem){
                 newItemInputElem.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleAddItem(); });
            }
            if(categoryItemListElem) {
                 categoryItemListElem.addEventListener('click', handleDeleteItem);
            }

            if(addSuspectBtn){
                addSuspectBtn.addEventListener('click', () => {
                    const rowCount = suspectsTbody.rows.length + 1;
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td class="border-b p-2">
                            <input type="text" placeholder="Name" class="p-1 border rounded-md w-full">
                        </td>
                         <td class="border-b p-2">
                            <input type="text" placeholder="ID Number" class="p-1 border rounded-md w-full numeric-only">
                        </td>
                        <td class="border-b p-2">
                             <input type="file" class="p-1 border rounded-md w-full">
                        </td>
                        <td class="border-b p-2 text-center align-middle">
                            <button type="button" class="remove-row-btn text-red-500 font-bold px-2">X</button>
                        </td>
                    `;
                    suspectsTbody.appendChild(newRow);
                });
            }

            if(suspectsTbody){
                suspectsTbody.addEventListener('click', (event) => {
                    if (event.target.classList.contains('remove-row-btn')) {
                        event.target.closest('tr').remove();
                    }
                });
            }

            // --- INITIALIZATION ---
            const initializeApp = () => {
                loadDropdownOptions();
                
                // Populate all SAPS 13 number fields
                const sapContainers = document.querySelectorAll('.sap-container');
                sapContainers.forEach(container => {
                    const monthSelect = container.querySelector('.sap-month');
                    const yearSelect = container.querySelector('.sap-year');
                    populateSapDropdowns(monthSelect, yearSelect);
                });
                
                updateAllDropdowns();
                updateObNumberDisplay();
                document.querySelectorAll('.autosize-input').forEach(input => autosizeInput(input));
                if(categorySelectorElem) {
                    renderCategoryEditor(categorySelectorElem.value);
                }
            };

            initializeApp();
        });
    </script>
</body>
</html>

